version: '3.8'

services:
  # Frontend - React App with Nginx
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    ports:
      - "3000:80"
    depends_on:
      - backend
    networks:
      - online-ide-network

  # Backend - Node.js API
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    ports:
      - "5000:5000"
    environment:
      - PORT=5000
      - MONGO_URI=mongodb://mongodb:27017/online-ide
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - /tmp/online-ide:/tmp/online-ide
    depends_on:
      - mongodb
    networks:
      - online-ide-network

  # MongoDB Database
  mongodb:
    image: mongo:7
    ports:
      - "27017:27017"
    volumes:
      - mongodb-data:/data/db
    networks:
      - online-ide-network

  # Python Compiler Image
  python-compiler:
    build:
      context: ./Docker/python
      dockerfile: Dockerfile
    image: online-ide-python
    command: echo "Python compiler image built"

  # C++ Compiler Image
  cpp-compiler:
    build:
      context: ./Docker/cpp
      dockerfile: Dockerfile
    image: online-ide-cpp
    command: echo "C++ compiler image built"

  # Node.js Runtime Image
  nodejs-runtime:
    build:
      context: ./Docker/nodejs
      dockerfile: Dockerfile
    image: online-ide-nodejs
    command: echo "Node.js runtime image built"

volumes:
  mongodb-data:

networks:
  online-ide-network:
    driver: bridge
